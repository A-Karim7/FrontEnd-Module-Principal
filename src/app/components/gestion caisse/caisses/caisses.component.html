<div class="grid">
    <div class="col-12">
        <div class="card">
            <mat-stepper linear #stepper>
                <mat-step [stepControl]=""  *ngIf="findRole(['ROLE_SUPERADMIN'])" completed="false" label="Choisir DRP " editable="false">


                    <h3 class="bg-gray-200 p-3">Choisir une Drp </h3>
                    <!-- <div class="p-fluid">
                        <p-autoComplete placeholder="Choisir une Drp " id="drps" [dropdown]="true" [multiple]="false"
                        [suggestions]="listdrpfiltre" (completeMethod)="filterDrp($event)" field="libelle"  [(ngModel)]="drpchoisi"></p-autoComplete>
                        <small *ngIf="(submitted)" class="p-error">Selectionnez une Drp.</small>

                    </div> -->
                    <div class="field col-12 md:col-4">
                        <p-dropdown inputId="dropdown" appendTo="body" [autoDisplayFirst]="false" [options]="listdrp" [(ngModel)]="drpchoisi" optionLabel="libelle" class="ng-invalid ng-dirty" placeholder="Selectionner">

                        </p-dropdown>
                    </div>
                    <br><br>
                    <div class="grid grid-nogutter justify-content-end">

                        <button mat-raised-button  color="primary" (click)="choixDrp()"[disabled]="drpchoisi==null">Suivant </button>
                    </div>

                </mat-step>
                 <mat-step [stepControl]=""  *ngIf="findRole(['ROLE_SUPERADMIN','ROLE_DRP'])" completed="false" label="Choisir Structure " editable="false">
                   <h3 class="bg-gray-200 p-3" >{{drpchoisi?.libelle}}</h3>
                   <h3 class="bg-gray-200 p-3">Choisir une Structure </h3>
                    <div class="p-fluid">
                        <p-autoComplete placeholder="Choisir une Structure" appendTo="body" id="drps" [dropdown]="true" [multiple]="false" height="70px"
                        [suggestions]="listbureaufiltre" (completeMethod)="filterbureau($event)" field="libelle" [(ngModel)]="structurechoisi" ></p-autoComplete>
                        <small class="ng-dirty ng-invalid" *ngIf="submitted">Selection  obligatoire.</small>

                    </div>
                    <!-- <div class="field col-12 md:col-8">
                        <p-dropdown inputId="dropdown" appendTo="body" [autoDisplayFirst]="false" [options]="structureList " [(ngModel)]="structurechoisi" optionLabel="libelle" class="ng-invalid ng-dirty" placeholder="Selectionner">

                        </p-dropdown>
                    </div> -->
                    <br><br>
                    <div class="grid grid-nogutter justify-content-end">

                        <button mat-raised-button matStepperNext (click)="resetStepper()"  color="warn">Retour </button>
                        <button mat-raised-button  color="primary" (click)="choixStructure()">Suivant </button>

                    </div>
                </mat-step>

                <mat-step [stepControl]="" *ngIf="findRole(['ROLE_SUPERADMIN','ROLE_DRP','ROLE_RECEVEUR', 'ROLE_RESPONSABLE_ANNEXE'])"  label="Liste des Caisses" editable="false">

               <br>

            <p-toolbar styleClass="mb-4">
                <ng-template pTemplate="left">
                    <div class="my-2">
                        <button *ngIf="findRole(['ROLE_SUPERADMIN','ROLE_DRP'])"  pButton pRipple label="Ajouter une nouvelle Caisse" icon="pi pi-plus" class="p-button-success mr-4" (click)="openNew()" ></button>
                        <button *ngIf="findRole(['ROLE_SUPERADMIN'])"  pButton pRipple label=" Management de  TypeCaisse" icon="pi pi-plus" class="p-button-success mr-4" (click)="openTypecaisse()"></button>

                    </div>
                </ng-template>
                <ng-template pTemplate="right">
                    <button pButton pRipple label="Export" icon="pi pi-upload" class="p-button-help" (click)="dt.exportCSV()"></button>
                </ng-template>
            </p-toolbar>

            <p-table #dt [value]="listeCaisses" [columns]="cols" responsiveLayout="scroll" [rows]="10" [globalFilterFields]="['libelle','structure','typeCaisse','user.nom.prenom']" [rows]="10" [paginator]="true" [rowsPerPageOptions]="[10,20,30]" [showCurrentPageReport]="true" currentPageReportTemplate="Affichage des {first} aux {last} of {totalRecords} entrées" [(selection)]="selectedCaisses" selectionMode="multiple" [rowHover]="true" dataKey="id">
                <ng-template pTemplate="caption">
                    <div class="flex flex-column md:flex-row md:justify-content-between md:align-items-center">
                        <h3 class="m-0"><b  style="color:blue;"><span> Liste des Caisses  {{title1 || title2?.libelle}}   --- {{structurechoisi?.dg_drp.libelle || title2?.dg_drp.libelle}}</span></b></h3>

                        <span class="block mt-2 md:mt-0 p-input-icon-left">
                            <i class="pi pi-search"></i>
                            <input pInputText type="text" (input)="dt.filterGlobal($event.target.value, 'contains')" placeholder="Rechercher..." />
                        </span>
                    </div>
                </ng-template>
                <ng-template pTemplate="header">
                    <tr>

                        <th pSortableColumn="libelle">Libelle <p-sortIcon field="libelle"></p-sortIcon>
                        </th>
                        <!-- <th pSortableColumn="structure">Structure <p-sortIcon field="structure"></p-sortIcon></th> -->
                        <th pSortableColumn="typeCaisse">Type Caisse <p-sortIcon field="typeCaisse"></p-sortIcon></th>
                        <th pSortableColumn="users">users <p-sortIcon field="users"></p-sortIcon></th>
                        <th  pSortableColumn="action">Actions<p-sortIcon field="action"></p-sortIcon></th>
                        <th></th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-caisse >
                    <tr>

                        <td style=" min-width:10rem;" >
                            <span class="p-column-title">Libelle</span>
                            {{caisse.libelle}}
                        </td>
                        <!-- <td style=" min-width:10rem;">
                            <span class="p-column-title">Structure</span>

                        </td> -->

                        <td  style=" min-width:10rem;">
                            <span class="p-column-title">Type Caisse</span>
                            <span  *ngIf="caisse.dg_typeCaisse != undefined">
                            {{caisse.dg_typeCaisse.libelle}}
                           </span>
                        </td>

                        <td  style=" min-width:10rem;">
                            <span class="p-column-title">user</span>
                            <span  *ngIf="caisse.dg_user != undefined">
                            {{caisse.dg_user.nom }} {{caisse.dg_user.prenom}}
                            </span>
                            <span *ngIf="caisse.dg_user ==undefined">
                                <p-tag styleClass="mr-12" severity="danger" value=" Non Attribuée">
                                </p-tag>
                            </span>

                        </td>
                        <td  >
                            <div class="flex">
                                <button   label="Détails" pButton pRipple icon="pi pi-search-plus"  class="p-button-rounded p-button-primary p-mr-3" (click)="openDetails(caisse)"></button>
                                <button *ngIf="findRole(['ROLE_SUPERADMIN','ROLE_DRP'])" pButton pRipple icon="pi pi-pencil" class="p-button-rounded p-button-warning mr-2" (click)="editCaisse(caisse)"></button>
                            </div>
                        </td>

                        <!-- <td>
                            <div class="flex">

                                <span *ngIf="caisse.dg_user ==undefined">
                                    <button pButton pRipple icon="pi pi-pencil" label="Attribution"
                                        class="p-button-secondary mr-2 mb-2"
                                        (click)="editCaisse(Caisse)"></button>
                                </span>

                            </div>
                        </td> -->
                    </tr>
                </ng-template>

            </p-table>
            <div class="grid grid-nogutter justify-content-end">
                <button mat-raised-button matStepperNext (click)="resetStepper()"  color="warn">Retour </button>
            </div>

<span *ngIf="isannexe==false">
            <h5 style="color:blue;">Liste des Bureaux Annexes </h5>
<p-listbox [options]="structureAnnexe" [(ngModel)]="annexe" optionLabel="annexe.libelle" [style]="{'width':'15rem'}" (click)="showDialog(annexe)"></p-listbox>
</span>
</mat-step>





</mat-stepper>
</div>
<!--
    <h5>Filter Menu</h5>
    <p-table #dt1 [value]="listStructure" dataKey="id" [rows]="10" [loading]="loading" [rowHover]="true" styleClass="p-datatable-gridlines" [paginator]="true" [globalFilterFields]="['name','country.name','representative.name','status']" responsiveLayout="scroll">
        <ng-template pTemplate="caption">
            <div class="flex justify-content-between flex-column sm:flex-row">
                <button pButton label="Clear" class="p-button-outlined mb-2" icon="pi pi-filter-slash" (click)="clear(dt1)"></button>
                <span class="p-input-icon-left mb-2">
                    <i class="pi pi-search"></i>
                    <input pInputText type="text" #filter (input)="dt1.filterGlobal($event.target.value, 'contains')" placeholder="Search Keyword" class="w-full"/>
                </span>
            </div>
        </ng-template>
        <ng-template pTemplate="header">
            <tr>
                <th>
                    <div class="flex justify-content-between align-items-center">
                      libelle
                    </div>
                </th>

            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-structureAnnexe>
            <tr>
                <td style="min-width: 12rem;">
                    {{structureAnnexe.dg_structureBureau.annexe.libelle}}
                </td>
            </tr>
        </ng-template> -->
    <!-- </p-table> -->
        <p-dialog [(visible)]="caisseDialog" [style]="{width: '500px', height:'600px'}" header="Détails caisse" [modal]="true" class="p-fluid">
            <ng-template pTemplate="content">
                <div class="field">
                    <label for="libelle"><b>Libelle</b></label>
                    <input type="text" pInputText id="libelle" [(ngModel)]="caisse.libelle" *ngIf="caisse.id ==null"required  [ngClass]="{'ng-invalid ng-dirty' : submitted && !caisse.libelle}"placeholder="libelle"/>
                    <input type="text" pInputText id="libelle" [(ngModel)]="caisse.libelle" *ngIf="caisse.id !=null"   [ngClass]="{'ng-invalid ng-dirty' : submitted && !caisse.libelle}"placeholder="libelle"/>
                    <small class="ng-dirty ng-invalid" *ngIf="submitted && !caisse.libelle">Libelle est obligatoire.</small>
                </div>
                <div class="field col-12 md:col-8" *ngIf="champstructure==true">
					<label htmlFor="structures"><b>Selectionné la Structures</b></label>
                    <p-autoComplete id="structures" field="libelle" [suggestions]="filteredCountries" [dropdown]="true"  (completeMethod)="filterCountry($event)"  [multiple]="false" [(ngModel)]="caisse.dg_structure" id="champstructure" [disabled]="true"> </p-autoComplete>

                     <!-- <p-dropdown  [options]="listStructure" optionLabel="libelle" [(ngModel)]="dg_struct"*ngIf="caisse.id==null" placeholder="Selectionné la Structures"></p-dropdown>
                     <p-dropdown  [options]="listStructure" optionLabel="libelle" [(ngModel)]="caisse.dg_structure.libelle"*ngIf="caisse.id !=null" editable="true" [disabled]="true"></p-dropdown> -->


				</div>
                <div class="field col-12 md:col-8">
					<label htmlFor="caisse"><b>Selectionné le Type de Caisse</b></label>

                    <p-autoComplete  id="caisse" field="libelle" [suggestions]="filteredCaisses" [dropdown]="true"  (completeMethod)="filtercaisse($event)"  [multiple]="false" [(ngModel)]="caisse.dg_typeCaisse"placeholder="selectionné ici"></p-autoComplete>

					<!-- <p-dropdown  [options]="listtypecaisse" optionLabel="libelle" [(ngModel)]="dg_type_struct" *ngIf="caisse.id == null" placeholder="Selectionné le Type de Caisse"></p-dropdown>
                    <p-dropdown  [options]="listtypecaisse"  [(ngModel)]="dg_type_struct"  optionLabel="libelle"  *ngIf="caisse.id != null" editable="true" ></p-dropdown> -->

				</div>
            </ng-template>
            <ng-template pTemplate="footer">
                <button pButton pRipple type="button" label="Annuler" icon="pi pi-times"  class="p-button-danger" (click)="hideDialog()"></button>
                <button pButton pRipple type="button" label="Ajouter" icon="pi pi-check"  class="p-button-success" *ngIf="caisse.id == null" (click)="saveCaisse()"></button>
            </ng-template>


        </p-dialog>
        <p-dialog [(visible)]="caisseDialog2" [style]="{width: '500px', height:'600px'}" header="Détails caissev 2" [modal]="true" class="p-fluid">
            <ng-template pTemplate="content">
                <div class="field">
                    <label for="libelle"><b>Libelle</b></label>
                    <input type="text" pInputText id="libelle" [(ngModel)]="caisse.libelle" *ngIf="caisse.id ==null"required  [ngClass]="{'ng-invalid ng-dirty' : submitted && !caisse.libelle}"placeholder="libelle"/>
                    <input type="text" pInputText id="libelle" [(ngModel)]="caisse.libelle" *ngIf="caisse.id !=null"   [ngClass]="{'ng-invalid ng-dirty' : submitted && !caisse.libelle}"placeholder="libelle"/>
                    <small class="ng-dirty ng-invalid" *ngIf="submitted && !caisse.libelle">Libelle est obligatoire.</small>
                </div>
                <div class="field col-12 md:col-8">
					<label htmlFor="state"><b>Selectionné la Structures</b></label>
                    <p-autoComplete id="structures" field="libelle" [suggestions]="filteredCountries" [dropdown]="true"  (completeMethod)="filterCountry($event)"  [multiple]="false"  [(ngModel)]="caisse.dg_structure"[disabled]="true"></p-autoComplete>


                     <!-- <p-dropdown  [options]="listStructure" optionLabel="libelle" [(ngModel)]="dg_struct"*ngIf="caisse.id==null" placeholder="Selectionné la Structures"></p-dropdown>
                     <p-dropdown  [options]="listStructure" optionLabel="libelle" [(ngModel)]="caisse.dg_structure.libelle"*ngIf="caisse.id !=null" editable="true" [disabled]="true"></p-dropdown> -->


				</div>
                <div class="field col-12 md:col-8">
					<label htmlFor="state"><b>Selectionné le Type de Caisse</b></label>
                    <p-autoComplete id="caisse" field="libelle" [suggestions]="filteredCaisses" [dropdown]="true"  (completeMethod)="filtercaisse($event)"  [multiple]="false"  [(ngModel)]="caisse.dg_typeCaisse"></p-autoComplete>

					<!-- <p-dropdown  [options]="listtypecaisse" optionLabel="libelle" [(ngModel)]="dg_type_struct" *ngIf="caisse.id == null" placeholder="Selectionné le Type de Caisse"></p-dropdown>
                    <p-dropdown  [options]="listtypecaisse"  [(ngModel)]="dg_type_struct"  optionLabel="libelle"  *ngIf="caisse.id != null" editable="true" ></p-dropdown> -->

				</div>
            </ng-template>
            <ng-template pTemplate="footer">
                <button pButton pRipple type="button" label="Annuler" icon="pi pi-times"  class="p-button-danger" (click)="hideDialog()"></button>
                <button pButton pRipple type="button" label="Modifier" icon="pi pi-check"  class="p-button-success" (click)="saveCaisse()"></button>
            </ng-template>


        </p-dialog>

        <p-dialog [(visible)]="deleteCaisseDialog" header="Confirm" [modal]="true" [style]="{width:'450px'}">
            <div class="flex align-items-center justify-content-center">
                <i class="pi pi-exclamation-triangle mr-3" style="font-size: 2rem"></i>
                <span *ngIf="product">Are you sure you want to delete <b>{{product.name}}</b>?</span>
            </div>
            <ng-template pTemplate="footer">
                <button pButton pRipple icon="pi pi-times" class="p-button-text" label="No" (click)="deleteCaisseDialog = false"></button>
                <button pButton pRipple icon="pi pi-check" class="p-button-text" label="Yes" (click)="confirmDelete()"></button>
            </ng-template>
        </p-dialog>

        <p-dialog [(visible)]="deleteCaissesDialog" header="Confirm" [modal]="true" [style]="{width:'450px'}">
            <div class="flex align-items-center justify-content-center">
                <i class="pi pi-exclamation-triangle mr-3" style="font-size: 2rem"></i>
                <span>Are you sure you want to delete selected products?</span>
            </div>
            <ng-template pTemplate="footer">
                <button pButton pRipple icon="pi pi-times" class="p-button-text" label="No" (click)="deleteCaissesDialog = false"></button>
                <button pButton pRipple icon="pi pi-check" class="p-button-text" label="Yes" (click)="confirmDeleteSelected()"></button>
            </ng-template>
        </p-dialog>

        <p-dialog [(visible)]="typecaisseDialog" [style]="{width: '50vw'}" header="Management des Fonctions" [modal]="true" styleClass="p-fluid">

            <ng-template pTemplate="content">
                <h5 style="text-align: center;">Ajout d'un nouveau type de Caisse</h5>
                <div style="height:50vw;">
                    <div class="p-field">
                        <label for="Libelle" >Libelle Caisse</label>
                    <input type="text" pInputText id="libelle" [(ngModel)]="typecaisse.libelle" required   />
                    <small class="p-invalid" *ngIf="submitted && !typecaisse.libelle">Libelle requis</small>
                     </div>
                <br>
                <button  pButton pRipple label="Ajouter" icon="pi pi-plus" class="p-button-primary" (click)="ajoutTypeCaisse()" style="width: 25%;"></button>
                <h5 style="text-align: center;"> Liste des Fonctions</h5>

                <p-table [value]="listtypecaisse" dataKey="id" editMode="row">
                    <ng-template pTemplate="header">
                        <tr>
                            <th>Libelle</th>
                            <th style="width:8rem"></th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-typecaisse let-editing="editing" let-ri="rowIndex">
                        <tr [pEditableRow]="typecaisse">
                            <td >
                                <p-cellEditor>
                                    <ng-template pTemplate="input">
                                        <input pInputText type="text" [(ngModel)]="typecaisse.libelle">
                                    </ng-template>
                                    <ng-template pTemplate="output">
                                        {{typecaisse.libelle}}
                                    </ng-template>
                                </p-cellEditor>
                            </td>

                                <td style="text-align: center;">
                                    <button *ngIf="!editing" pButton pRipple type="button" pInitEditableRow icon="pi pi-pencil" (click)="editTypecaisse(typecaisse)" class="p-button-rounded p-button-text"></button>
                                    <button *ngIf="editing" pButton pRipple type="button" pSaveEditableRow icon="pi pi-check" (click)="saveTypecaisse(typecaisse)" class="p-button-rounded p-button-text p-button-success p-mr-2"></button>
                                    <button *ngIf="!editing" pButton pRipple type="button" pSaveEditableRow icon="pi pi-trash" (click)="deleteTypecaisse(typecaisse)" class="p-button-rounded p-button-text p-button-success p-mr-2"></button>
                            </td>
                            </tr>
                            </ng-template>
                            </p-table>
                </div>


            </ng-template>

        </p-dialog>
        <p-dialog [(visible)]="detailsDialog" [style]="{width: '30vw',height:'100'}" [modal]="true" styleClass="p-fluid">
        <!-- <p-table #dt1 [value]="customers1" dataKey="id" [rows]="10" [loading]="loading" [rowHover]="true" styleClass="p-datatable-gridlines" [paginator]="true" [globalFilterFields]="['name','country.name','representative.name','status']" responsiveLayout="scroll"> -->
            <h5  style="text-align: center; background-color:blue;color: white;"><b>Détails du Compte</b></h5>
             <ng-template pTemplate="content">
              <span>

                <span *ngIf="caisse.dg_user!=null || caisse.dg_user!=undefined">
                <span class="font-weight-bold">Utilisateur:</span>
                  <span > <b>{{caisse.dg_user.prenom}} {{caisse.dg_user.nom}}</b></span>
                </span>
              <ng-template>
              </ng-template> <br> <br></span>
               <span> <span class="font-weight-bold">Libelle de la Caisse:&nbsp; &nbsp;</span><b>{{caisse.libelle}}</b></span> <br> <br>
                      <span> <span class="font-weight-bold">Numeraire:</span><b>{{caisse.numeraire}}</b> </span> <br> <br>
                      <span> <span class="font-weight-bold">Cheque:</span> <b>{{caisse.cheque}}</b> <br> <br></span>
                      <span> <span class="font-weight-bold">Bonvert:</span><b> {{caisse.bonvert}} </b><br> <br></span>
                      <span> <span class="font-weight-bold">Autorisation DG:</span><b> {{caisse.autorisation_dg}} </b><br> <br></span>
                      <span> <span class="font-weight-bold">Douane:</span> <b>{{caisse.douane}}</b> <br> <br></span>
                      <span> <span class="font-weight-bold">ccp:</span> <b>{{caisse.ccp}} </b><br> <br></span>
                      <span> <span class="font-weight-bold">Taxe Frais:</span> <b>{{caisse.taxe_Frais}} </b><br> <br></span>
                      <span> <span class="font-weight-bold">Numeraire Veille:</span> <b>{{caisse.numeraire_Veille}}</b> <br> <br></span>
                      <span> <span class="font-weight-bold">Cheque Rejetée:</span> <b>{{caisse.cheque_Rejete}} </b><br> <br></span>
                      <span> <span class="font-weight-bold">Contentieux:</span> <b>{{caisse.contentieux}} </b><br> <br></span>

                      <br> <br>
                      <span>
                        <h3  style="text-align: center; background-color:blue;color: white;"><b>Historique Caisse</b></h3>
                       </span>
                 <p-table [value]="listhstocaisse" [rows]=4 >
                            <ng-template pTemplate="header">
                                <tr>
                                    <th>Date d'attribution</th>

                                    <th>Date de cloture</th>

                                    <th>Nom</th>

                                    <th>Prenom</th>

                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body"   let-histo >
                                <tr>

                                             <td >
                                              {{histo.dateattribution |date:'dd/MM/yyyy'}}
                                            </td>
                                            <td >
                                              {{histo.datecloture |date:'dd/MM/yyyy'}}
                                            </td>
                                            <td>
                                                <span  *ngIf="histo.dg_user.nom != null && histo.dg_user.nom != undefined ">
                                                {{histo.dg_user.nom }}
                                                </span>
                                                <span *ngIf="histo.dg_user.nom ==null && histo.dg_user.nom ==undefined">
                                                    <p-tag styleClass="mr-12" severity="warning" value=" pas de history pour".{{histo.dg_user.nom }} >
                                                    </p-tag>
                                                </span>

                                            </td>
                                            <td>
                                                <span  *ngIf="histo.dg_user.prenom != undefined && histo.dg_user.prenom != null">
                                               {{histo.dg_user.prenom}}
                                                </span>
                                                <span *ngIf="histo.dg_user.prenom ==null && histo.dg_user.prenom ==undefined">
                                                    <p-tag styleClass="mr-12" severity="warning" value=" pas de history pour".{{histo.dg_user.prenom }}>
                                                    </p-tag>
                                                </span>

                                            </td>


                            </tr>
                            </ng-template>
                            </p-table>








             </ng-template>
          </p-dialog>

          <p-confirmDialog [style]="{width: '50vw'}" [baseZIndex]="10000" rejectButtonStyleClass="p-button-text"></p-confirmDialog>

            <p-dialog [(visible)]="annexeDialogCaisse" [style]="{width: '70vw',height:'500px'}"  [modal]="true" styleClass="p-fluid">

                <p-toolbar styleClass="mb-4">
                    <ng-template pTemplate="left">
                            <button *ngIf="findRole(['ROLE_SUPERADMIN','ROLE_DRP'])"  pButton pRipple label="Ajouter une nouvelle Caisse" icon="pi pi-plus" class="p-button-success mr-4" (click)="openNew2()" ></button>
                            <button *ngIf="findRole(['ROLE_SUPERADMIN'])"  pButton pRipple label=" Management de  TypeCaisse" icon="pi pi-plus" class="p-button-success mr-4" (click)="openTypecaisse()"></button>

                    </ng-template>
                    <ng-template pTemplate="right">
                        <button pButton pRipple label="Export" icon="pi pi-upload" class="p-button-help" (click)="dt.exportCSV()"></button>
                    </ng-template>
                </p-toolbar>

                <p-table #dt [value]="listcaissesannexe" [columns]="cols" responsiveLayout="scroll" [rows]="10" [globalFilterFields]="['libelle','structure','typeCaisse','user.nom.prenom']" [rows]="10" [paginator]="true" [rowsPerPageOptions]="[10,20,30]" [showCurrentPageReport]="true" currentPageReportTemplate="Affichage des {first} aux {last} of {totalRecords} entrées" [(selection)]="selectedCaisses" selectionMode="multiple" [rowHover]="true" dataKey="id">
                    <ng-template pTemplate="caption">
                        <div class="flex flex-column md:flex-row md:justify-content-between md:align-items-center">
                            <h3 class="m-0"><b  style="color:blue;"><span>Liste des Caisses {{titre}}  </span></b></h3>

                            <span class="block mt-0 md:mt-0 p-input-icon-left">
                                <i class="pi pi-search"></i>
                                <input pInputText type="text" (input)="dt.filterGlobal($event.target.value, 'contains')" placeholder="Rechercher..." />
                            </span>
                        </div>
                    </ng-template>
                    <ng-template pTemplate="header">
                        <tr>

                            <th pSortableColumn="libelle">Libelle <p-sortIcon field="libelle"></p-sortIcon>
                            </th>
                            <!-- <th pSortableColumn="structure">Structure <p-sortIcon field="structure"></p-sortIcon></th> -->
                            <th pSortableColumn="typeCaisse">Type Caisse <p-sortIcon field="typeCaisse"></p-sortIcon></th>
                            <th pSortableColumn="users">users <p-sortIcon field="users"></p-sortIcon></th>
                            <th pSortableColumn="action">Actions<p-sortIcon field="action"></p-sortIcon></th>
                            <th></th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-caisseannexe>
                        <tr>

                            <td style=" min-width:10rem;" >
                                <span class="p-column-title">Libelle</span>
                                {{caisseannexe.libelle}}
                            </td>
                            <!-- <td style=" min-width:10rem;">
                                <span class="p-column-title">Structure</span>

                            </td> -->

                            <td  style=" min-width:10rem;">
                                <span class="p-column-title">Type Caisse</span>
                                <span  *ngIf="caisseannexe.dg_typeCaisse != undefined">
                                {{caisseannexe.dg_typeCaisse.libelle}}
                               </span>
                            </td>

                            <td  style=" min-width:10rem;">
                                <span class="p-column-title">user</span>
                                <span  *ngIf="caisseannexe.dg_user != undefined">
                                {{caisseannexe.dg_user.nom }} {{caisseannexe.dg_user.prenom}}
                                </span>
                                <span *ngIf="caisseannexe.dg_user ==undefined">
                                    <p-tag styleClass="mr-12" severity="danger" value=" Non Attribuée">
                                    </p-tag>
                                </span>

                            </td>
                            <td>
                                <div class="flex">
                                    <button label="Détails" pButton pRipple icon="pi pi-search-plus"  class="p-button-rounded p-button-primary p-mr-3" (click)="openDetails2(caisseannexe)"></button>
                                    <button pButton pRipple icon="pi pi-pencil"
                                    class="p-button-rounded p-button-primary mr-2" (click)="editCaisse2(caisseannexe)"></button>
                                </div>
                            </td>

                            <!-- <td>
                                <div class="flex">

                                    <span *ngIf="caisse.dg_user ==undefined">
                                        <button pButton pRipple icon="pi pi-pencil" label="Attribution"
                                            class="p-button-secondary mr-2 mb-2"
                                            (click)="editCaisse(Caisse)"></button>
                                    </span>

                                </div>
                            </td> -->
                        </tr>
                    </ng-template>

                </p-table>

            </p-dialog>
            <p-dialog [(visible)]="detailsDialog2" [style]="{width: '50vw',height:'100'}" [modal]="true" styleClass="p-fluid">
                <!-- <p-table #dt1 [value]="customers1" dataKey="id" [rows]="10" [loading]="loading" [rowHover]="true" styleClass="p-datatable-gridlines" [paginator]="true" [globalFilterFields]="['name','country.name','representative.name','status']" responsiveLayout="scroll"> -->
                    <h5  style="text-align: center; background-color:blue;color: white;"><b>Détails du CompteAnnexe</b></h5>
                     <ng-template pTemplate="content">
                      <span> <span class="font-weight-bold">Utilisateur:</span>
                          <span > <b>{{annexe.dg_user.prenom}} {{annexe.dg_user.nom}}</b></span>
                      <ng-template>
                      </ng-template> <br> <br></span>
                       <span> <span class="font-weight-bold">Libelle de la Caisse:&nbsp; &nbsp;</span><b>{{annexe.libelle}}</b></span> <br> <br>
                              <span> <span class="font-weight-bold">Numeraire:</span><b>{{annexe.numeraire}}</b> </span> <br> <br>
                              <span> <span class="font-weight-bold">Cheque:</span> <b>{{annexe.cheque}}</b> <br> <br></span>
                              <span> <span class="font-weight-bold">Bonvert:</span><b> {{annexe.bonvert}} </b><br> <br></span>
                              <span> <span class="font-weight-bold">Autorisation DG:</span><b> {{annexe.autorisation_dg}} </b><br> <br></span>
                              <span> <span class="font-weight-bold">Douane:</span> <b>{{annexe.douane}}</b> <br> <br></span>
                              <span> <span class="font-weight-bold">ccp:</span> <b>{{annexe.ccp}} </b><br> <br></span>
                              <span> <span class="font-weight-bold">Taxe Frais:</span> <b>{{annexe.taxe_Frais}} </b><br> <br></span>
                              <span> <span class="font-weight-bold">Numeraire Veille:</span> <b>{{annexe.numeraire_Veille}}</b> <br> <br></span>
                              <span> <span class="font-weight-bold">Cheque Rejetée:</span> <b>{{annexe.cheque_Rejete}} </b><br> <br></span>
                              <span> <span class="font-weight-bold">Contentieux:</span> <b>{{annexe.contentieux}} </b><br> <br></span>

                              <br> <br>
                              <span>
                                <h3  style="text-align: center; background-color:blue;color: white;"><b>Historique Caisse</b></h3>
                               </span>
                         <p-table [value]="listhstocaisseAnnexe" [rows]=4 >
                                    <ng-template pTemplate="header">
                                        <tr>
                                            <th>Date d'attribution</th>

                                            <th>Date de cloture</th>

                                            <th>Nom</th>

                                            <th>Prenom</th>

                                        </tr>
                                    </ng-template>
                                    <ng-template pTemplate="body"   let-histoAnnexe >
                                        <tr>

                                                     <td >
                                                      {{histoAnnexe.dateattribution |date:'dd/MM/yyyy'}}
                                                    </td>
                                                    <td >
                                                      {{histoAnnexe.datecloture |date:'dd/MM/yyyy'}}
                                                    </td>
                                                    <td>
                                                        <span  *ngIf="histoAnnexe.dg_user.nom != null && histoAnnexe.dg_user.nom != undefined ">
                                                        {{histoAnnexe.dg_user.nom }}
                                                        </span>
                                                        <span *ngIf="histoAnnexe.dg_user.nom ==null && histoAnnexe.dg_user.nom ==undefined">
                                                            <p-tag styleClass="mr-12" severity="warning" value=" pas de history pour".{{histoAnnexe.dg_user.nom }} >
                                                            </p-tag>
                                                        </span>

                                                    </td>
                                                    <td>
                                                        <span  *ngIf="histoAnnexe.dg_user.prenom != undefined && histoAnnexe.dg_user.prenom != null">
                                                       {{histoAnnexe.dg_user.prenom}}
                                                        </span>
                                                        <span *ngIf="histoAnnexe.dg_user.prenom ==null && histoAnnexe.dg_user.prenom ==undefined">
                                                            <p-tag styleClass="mr-12" severity="warning" value=" pas de history pour".{{histoAnnexe.dg_user.prenom }}>
                                                            </p-tag>
                                                            pas de history
                                                        </span>

                                                    </td>



                                    </tr>
                                    </ng-template>
                                    </p-table>








                     </ng-template>
                  </p-dialog>
                  <p-confirmDialog [style]="{width: '50vw'}" [baseZIndex]="10000" rejectButtonStyleClass="p-button-text"></p-confirmDialog>

    </div>

</div>
